@using WebAOMS.Models;
@{

    fmisEntities fmisdb = new fmisEntities();
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";

}

<div class="box">
    <div class="box-head">
        <header>
            <h4 class="text-bold">Mapping Criteria</h4>
        </header>
        <div class="tools">
            <div class="btn-group ">
                <a class="btn btn-equal btn-sm btn-refresh"><i class="fa fa-refresh"></i></a>
                <a class="btn btn-equal btn-sm btn-collapse"><i class="fa fa-angle-down"></i></a>
                <a class="btn btn-equal btn-sm btn-close"><i class="fa fa-times"></i></a>
            </div>
        </div>
    </div>
    <style>
        /*.k-loading-mask {
                display: none !important;
            }*/
    </style>
    <div class="box-body">
        <script>
            function para_dp() {
                return { claimantName: "" }
            }
        </script>
        <div id="payrollType-3" class="col-lg-12 no-padding hideoptiondiv" style="display:block">
            <div data-toggle="buttons">
                @*<label class="btn radio-inline btn-radio-success-inverse ">
                        <input name="mappingType" id="mappingType1" value="1" type="radio"> Employee
                    </label>
                    <label class="btn radio-inline btn-radio-success-inverse">
                        <input name="mappingType" id="mappingType2" value="2" type="radio"> Other Individual
                    </label>*@
                <label class="btn radio-inline btn-radio-success-inverse active">
                    <input name="mappingType" id="mappingType3" value="3" type="radio"> Procurement
                </label>
                <label class="btn radio-inline btn-radio-success-inverse">
                    <input name="mappingType" id="mappingType3" value="4" type="radio"> Warehouse Inventory
                </label>
                <label class="btn radio-inline btn-radio-success-inverse">
                    <input name="mappingType" id="mappingType3" value="5" type="radio"> Property
                </label>
                @*<label class="btn radio-inline btn-radio-success-inverse">
                        <input name="mappingType" id="mappingType4" value="4" type="radio"> Responsibility Center
                    </label>
                    <label class="btn radio-inline btn-radio-success-inverse">
                        <input name="mappingType" id="mappingType5" value="5" type="radio"> National Offices
                    </label>
                    <label class="btn radio-inline btn-radio-success-inverse">
                        <input name="mappingType" id="mappingType6" value="6" type="radio"> Barangay Treasurers
                    </label>*@
                <input id="mappingTypeID" value="3" hidden />

                <script>
                    $(function () {
                        $('input[name="mappingType"]').bind('change', function () {
                            $("#mappingTypeID").val($(this).val())
                            refrehGrid()
                        });
                    });
                </script>
            </div>
        </div>

        <script>

            function refrehGrid() {
                var grid = $("#grid_proc_item").data("kendoGrid");
                grid.dataSource.read()

            }

            function grid_para_proc_item() {
                return { claimantCode: $("#mappingTypeID").val(), name: $("#txt_search_name").val() }
            }

        </script>
    </div>
</div>

<div class="box">
    <div class="box-head col-lg-6">
        <header>
            <h4 class="text-bold">Procurement item that to be mapp</h4>
        </header>

    </div>

    <style>
        /*.k-loading-mask {
                display: none !important;
            }*/
    </style>
    <div class="box-body  col-lg-12">
        <div class="row">
            <div class="input-group control-width-large" style="padding-bottom:5px!important">
                <input id="txt_search_name" type="text" class="form-control navbar-input" placeholder="Search item name">
                <span class="input-group-btn">
                    <button class="btn btn-equal" onclick="click_search_claimant()" type="button"><i class="fa fa-search"></i></button>
                </span>
            </div>
        </div>
        <div id="div_tracking_1" class="row gridhideoptiondiv" style="display:block">
            @(Html.Kendo().Grid<WebAOMS.Models.Maintenance.grid_Item_Category>()
                    .Name("grid_proc_item")
                    .Columns(columns =>
                    {
                    columns.Bound(m=> m.itemgroupid).Width(60).Title("ID");
                    // columns.Select().Width(50).HtmlAttributes(new { @class = "checkbox-align" }).HeaderHtmlAttributes(new { @class = "checkbox-align" });
                    columns.Bound(m => m.itemcategory).Width(200).Title("Item Category");
                    columns.Bound(m => m.accountcode).Width(100).Title("Account Code");
                    @*columns.Template(@<text></text>)
                    .Width(130)
                    .Title("Credit")
                    .HtmlAttributes(new { style = "text-align:right;font-size:10" })
                    .ClientTemplate("<div id=\"div_credit_#=ChartAccountChildID#\"><button type=\"button\" id=\"btn_credit_#=ChartAccountChildID#\" onclick=\"edit_amount(#=credit#,#=ChartAccountChildID#,'credit',#=hasChild#,'#=AccountChildName#',#=code#,'#=ChildCode#',#=AccountChildParentID#)\" class=\"k-button DebitCredit\">#=addCommas(credit)#</button></div>");*@
                    })
                    .AutoBind(true)
                    .HtmlAttributes(new { style = "height: 500px;" })
                                    .Selectable(m => m
                        .Mode(GridSelectionMode.Single)
                        .Type(GridSelectionType.Row))
                    .Scrollable()
                    .Sortable()
                    .Events(e=> e.DataBound("dbclcik_item"))
                    .DataSource(dataSource => dataSource
                        .Ajax()
                        .Read(read => read.Action("grid_proc_item_server_search", "Maintenance"))
                        .PageSize(500)
                        .ServerOperation(true)
                        .Model(model => model.Id(p => p.itemgroupid))

                    .Sort(s => s.Add("itemcategory").Ascending())
                    )
            //.Events(ev => ev.Change("onChange"))
            )
        </div>

        <script>
            var claimantcode;
            var itemgroupid;

            function dbclcik_item() {
                var rows = this.items();
                var grid_proc_item = $("#grid_proc_item").data("kendoGrid");
                rows.on("dblclick", function (e) {
                    var row = $(e.currentTarget);

                    var dataItem = grid_proc_item.dataItem(row)
                    itemgroupid = dataItem.itemgroupid
                    $("#dp_ChartAccountID").data("kendoDropDownList").value(dataItem.accountcode)
                    $("#mdl_mapp_item").modal("show");
                });
            }

            function onChange(arg) {
                claimantcode = this.selectedKeyNames().join(",");
            }


                $('#txt_search_name').on('keydown', function (e) {
                    if (e.keyCode == 13) {
                        refrehGrid()
                    }
                })





        </script>
    </div>

    <div class="box-footer">
        <div class="col-lg-12" style="height:50px">
            <button id="btn_process" onclick="process_mapping()" type="button" class="btn btn-success"><i class="fa fa-gears"></i> Process</button>
            @*<button id="btn_set" onclick="SetActive()" type="button" class="btn btn-success"><i class="fa fa-gears"></i> Set As Active</button>*@
        </div>
    </div>
</div>

<div class="modal" id="mdl_mapp_item" data-backdrop="static" data-keyboard="false" role="dialog" aria-hidden="true" style="display: none;">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true" onclick="close_browse_claimant()">x</button>
                <h4 class="modal-title">Category Mapping </h4>
            </div>
            <div id="body_add_claimant" class="modal-body" style="height:50px">
                <div class="form-group" style=" padding-bottom:10px">
                    <div class="col-lg-2 col-md-2 col-sm-3">
                        <label for="Address" class="control-label">Account Name:</label>
                    </div>
                    <div class="col-lg-10 col-md-10 col-sm-10">
                        @(Html.Kendo().DropDownList()
                              .Name("dp_ChartAccountID")
                              .DataTextField("AccountName")
                              .DataValueField("AccountCode")
                              
                              .Filter("Contains")
                              .DataSource(source =>
                              {
                                  source.Read(read =>
                                  {
                                      read.Action("DataSource_Get_COA", "ChartOfAccounts");
                                  });
                              })
                              .HtmlAttributes(new { style = "width: 100%" })
                        )
                        <script>

            function click_save() {
                    startSpin()
                    $.post('@Url.Action("updateAccountCodeInCategory", "Maintenance")', { itemgroupid: itemgroupid, accountcode: $("#dp_ChartAccountID").data("kendoDropDownList").value() }, function (r) {
                        stopSpin()
                        if (r.code == 6) {
                            toastr.success(r.statusName, 'System Message');
                            refrehGrid();
                            $("#mdl_mapp_item").modal("hide");
                        }
                        else {
                            toastr.warning(r.statusName, 'System Message');
                        }
                    })
            }
                        </script>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button onclick="click_save()" type="button" class="btn btn-success"><i class="fa fa-check"></i> Save</button>
                <button type="button" class="btn btn-default" data-dismiss="modal" style="cursor:pointer">Close</button>
            </div>
        </div>
    </div>
</div>
