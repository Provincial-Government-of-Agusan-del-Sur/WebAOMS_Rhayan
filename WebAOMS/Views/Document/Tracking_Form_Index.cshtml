
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<style>
    .zdex {
        z-index: 500;
    }

    .modal-dialog-full {
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
    }

    .modal-content-full {
        height: auto;
        min-height: 100%;
        border-radius: 0;
    }
</style>
<div class="box">
    <div class="box-head" style="border-bottom:1px solid #e8e8e8">
        <header>
            <h4 class="text-bold">@ViewBag.Title_mini</h4>
        </header>
        <div class="tools">
            <div class="btn-group ">
                <a class="btn btn-equal btn-sm btn-refresh"><i class="fa fa-refresh"></i></a>
                <a class="btn btn-equal btn-sm btn-collapse"><i class="fa fa-angle-down"></i></a>
                <a class="btn btn-equal btn-sm btn-close"><i class="fa fa-times"></i></a>
            </div>
        </div>
    </div>
    <div class="box-body" style="padding-top:10px">
        <script>
            function para_coa (){
                return { IS_id: $("#dp_is_name").data("kendoDropDownList").value() }
            }

            function r_grid() {
                var grid = $("#grid_tracking_form").data("kendoGrid");
                grid.dataSource.read();
            }

            function edit_logs() {

            }

        </script>
        <div class="row">
            <div class="input-group control-width-large" style="padding-bottom:5px!important">
                <input id="txt_search_name_refno" type="text" class="form-control navbar-input" placeholder="Search...">
                <span class="input-group-btn">
                    <button class="btn btn-equal" onclick="click_search_claimant()" type="button"><i class="fa fa-search"></i></button>
                </span>
            </div>
        </div>
        <div class="row">
            @(Html.Kendo().Grid<WebAOMS.Models.ufn_grid_tracking_list_Result>()
        .Name("grid_tracking_form")
        .Columns(columns =>
        {
        //columns.Bound(m => m.doc_form_id).Title("Transation No").Width(100);
        columns.Bound(m => m.refno).Title("Tracking Reference").Format("{0:n2}").Width(150).HtmlAttributes(new { style = "font-family:Courier New!important;text-align:center" });
        columns.Bound(m => m.NameFML).Title("Liaison Officer").Width(150);
        columns.Bound(m => m.Particular).Width(400);
        columns.Template(@<text></text>)
        .Width(200).HtmlAttributes(new { style = "text-align:center" }).HeaderHtmlAttributes(new { style = "text-align:center" }).HeaderTemplate("Status")
        .ClientTemplate("<button class=\"k-button\" onclick=\"open_document('#=refno#')\" style=\"cursor:pointer;width:100%\" >#=Status_name#</button>");
            columns.Bound(m => m.remarks).Title("Remarks").Width(150);
            //columns.Bound(m => m.GAmount).Title("Gross Amount").Format("{0:n2}").Width(100);

            columns.Bound(m => m.DTE).Title("Date").Title("Date of Last Status").Width(150);
            columns.Template(@<text></text>)
        .Width(80)
        .HtmlAttributes(new { style = "text-align:left;font-size:10" })
        .ClientTemplate("<button data-toggle=\"tooltip\" data-placement=\"top\" type=\"button\" data-original-title=\"Edit tracking\" onclick=\"addnew(#=doc_form_id#)\" class=\"btn btn-xs btn-inverse btn-equal\" style=\"margin-right:2px\"><i class=\"fa fa-pencil\"></i></button><button data-original-title=\"recompute\" type=\"button\" onclick=\"print_tracking('#=refno#')\" class=\"btn btn-xs btn-inverse btn-equal\" style=\"margin-right:2px\"><i class=\"fa fa-print\"></i></button>");

        })
        .HtmlAttributes(new { style = "height: 400px;" })
         .Scrollable() // <== Enable virtualization
        .Sortable()
        .Pageable(pageable => pageable
        .Refresh(true)
        .ButtonCount(5))
        //.Filterable(ftb => ftb.Mode(GridFilterMode.Row))
        .Reorderable(reorder => reorder.Columns(true)) // Enable row reordering
        .DataSource(dataSource => dataSource
            .Ajax()
            .Read(read => read.Action("data_grid_tracking_list", "Document"))
             .ServerOperation(true)
             .PageSize(500)
        )
            )
        </div>
    </div>
    <div class="box-footer">
        <div class="btn-group" style="padding-left:10px;padding-bottom:10px;">
            <button onclick="addnew(0)" type="button" class="btn btn-default"><i class="fa fa-plus"></i> Add New</button>
        </div>
    </div>
</div>
<script>
   function open_document(refno) {
        startSpin()
        $.post('@Url.Action("open_document", "PreAudit")', { refno: refno }
            , function (r) {
                if (r.code == 5) {
                    stopSpin()
                    mg.warning("" + r.statusName + "", "System Message")
                }
                else {
                    var header = "Document History";
                    stopSpin()
                    $("#h_trackhistory_id").html(header);
                    $("#body_trackhistory").html(r)
                    $("#mdl_trackhistory").modal("show");
                }
            })
        .fail(function (jqXHR, textStatus, error) {
            stopSpin()

        });
    }

    var mg = new mgsInfo()
    function addnew(doc_form_id) {
        startSpin()
        $.post('@Url.Action("_Add_doc", "Document")', { doc_form_id: doc_form_id }
            , function (r) {
                if (r.code == 5) {
                    stopSpin()
                    mg.warning("" + r.statusName + "", "System Message")
                }
                else {
                    var header = "Add new transaction";
                    stopSpin()
                    if (doc_form_id != 0)
                    {
                        header = "Update tracking details"
                    }
                    $("#h_newstatus_id").html(header);
                    $("#body_newstatus").html(r)
                    $("#mdl_newstatus").modal("show");
                }
            })
        .fail(function (jqXHR, textStatus, error) {
            stopSpin()
            mg.warning("" + textStatus + "")
        });
    }

    function print_tracking(refno) {
        startSpin()
        $.post('@Url.Content("~/Document/print_tracking")', { refno:refno }
            , function (r) {
                stopSpin()
            })
    }
    //$('#txt_search_name_refno').on('keydown', function (e) {
    //    if (e.keyCode == 13) {
    //        click_search_refno()
    //    }
    //})
    $(function () {
        $("#txt_search_name_refno").keypress(function (e) {
            if (e.keyCode == 13) {
                click_search_claimant();
            }
        });
    });
    function click_search_claimant() {
        //if ($('#txt_search_name_refno').val().length > 0) {
        //    ISfn.applyFilter("refno", $('#txt_search_name_refno').val(), 'grid_tracking_form')
        //    //gridData.dataSource.sort({ field: "AccountChildName", dir: "asc" });
        //}
        //else {
        //    var gridData = $('#grid_tracking_form').data("kendoGrid");
        //    gridData.dataSource.filter({});
        //}
        var $filter = new Array();
        $filter = [];

        if ($('#txt_search_name_refno').val().length > 0) {
            $filter.push({ field: "refno", operator: "contains", value: $('#txt_search_name_refno').val() }),
            $filter.push({ field: "NameFML", operator: "contains", value: $('#txt_search_name_refno').val() }),
            $filter.push({ field: "Particular", operator: "contains", value: $('#txt_search_name_refno').val() });
        }

        $('#grid_tracking_form').data('kendoGrid').dataSource.filter({
            logic: "or",
            filters: $filter
        });
    }

</script>
<div class="modal" id="mdl_newstatus" data-backdrop="static" data-keyboard="false" role="dialog" aria-hidden="true" style="display: none;">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>
                <h4 id="h_newstatus_id" class="modal-title">Update the Particular</h4>
            </div>
            <div id="body_newstatus" class="modal-body" style="height:auto!important">

            </div>
            <div class="modal-footer">
                <div id="btn_attach" class="btn-group dropup">
                    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
                        Add document <i class="fa fa-caret-down"></i>
                    </button>
                    <ul class="dropdown-menu animation-slide" role="menu" style="text-align: left;">

                        <li><a href="#" onclick="load_dv(0,1,'DV/CAFOA',2025)"><i class="fa fa-file-pdf-o"></i> DV/CAFOA/FURS</a></li>
                        @*<li><a href="#" onclick="load_dv(0,16,'Activity Design')"><i class="fa fa-file-word-o"></i> Activity Design</a></li>*@
                        @*<li><a href="#" onclick="load_dv(0,46,'Activity Design')"><i class="fa fa-file-word-o"></i> Activity Design</a></li>
                            <li><a href="#" onclick="load_dv(0, 47, 'Training Design')"><i class="fa fa-file-word-o"></i> Training Design</a></li>*@

                        @*<li><a href="#" onclick="load_dv(0,48,'Activity Design',2024)"><i class="fa fa-file-word-o"></i> Activity Design 2024</a></li>*@
                        @*<li><a href="#" onclick="load_dv(0, 49, 'Training Design',2024)"><i class="fa fa-file-word-o"></i> Training Design(Procurement)</a></li>
                        <li><a href="#" onclick="load_dv(0, 50, 'PROCESS DESIGN',2024)"><i class="fa fa-file-word-o"></i> Process Design(Procurement)</a></li>*@

                        @*<li><a href="#" onclick="load_dv(0, 53, 'Activity Design',2024)"><i class="fa fa-file-word-o"></i> PLC-ACTIVITY DESIGN(None-Procurement)</a></li>
                        <li><a href="#" onclick="load_dv(0, 54, 'Training Design',2024)"><i class="fa fa-file-word-o"></i> PLC-TRAINING DESIGN(None-Procurement)</a></li>*@

                        <li><a href="#" onclick="load_dv(0,57,'Activity Design',2026)"><i class="fa fa-file-word-o"></i> Activity Design</a></li>
                        <li><a href="#" onclick="load_dv(0, 58, 'Training Activity Plan',2026)"><i class="fa fa-file-word-o"></i> Training Activity Plan (with process design)</a></li>
                        @*<li><a href="#" onclick="load_dv(0, 50, 'PROCESS DESIGN',2025)"><i class="fa fa-file-word-o"></i> Process Design</a></li>*@
                        @*<li><a href="#" onclick="load_dv(0,56,'Request Form')"><i class="fa fa-file-pdf-o"></i> Revision of Activity/Training Design</a></li>*@
                        <li><a href="#" onclick="load_dv(0, 10, 'NOTICE',2025)"><i class="fa fa-file-word-o"></i> Notice Block</a></li>
                        <li><a href="#" onclick="load_dv(0, 14, 'LETTER BLOCK',2025)"><i class="fa fa-file-word-o"></i> Letter Block</a></li>
                        <li><a href="#" onclick="load_dv(0, 13, 'MEMO BLOCK',2025)"><i class="fa fa-file-word-o"></i> MEMO Block</a></li>
                        <li><a href="#" onclick="load_dv(0, 17, 'CUSTOM',2025)"><i class="fa fa-file-word-o"></i> Custom Template</a></li>
                    </ul>
                </div>
                <button id="btn_revision_id" onclick="load_dv(0, 56, 'Request Form',2025)" type="button" class="btn btn-success"><i class="fa fa-info"></i> Request for Revision</button>
                <button id="btn_save_id" onclick="btn_save_status_log()" type="button" class="btn btn-success"><i class="fa fa-save"></i> Save Changes</button>
                <button id="btn_delete" onclick="warn_delete_doc_form()" type="button" class="btn btn-danger"><i class="fa fa-trash"></i> Delete</button>
                <button type="button" class="btn btn-default" style="cursor:pointer" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<div class="modal " id="mdl_doc_form" data-backdrop="static" data-keyboard="false" role="dialog" aria-hidden="true" style="display: none;">
    <div id="div_doc_id" class="modal-dialog modal-dialog-full">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true" onclick="removezindex()">x</button>
                <h4 id="h_doc_form_id" class="modal-title">Transaction Information</h4>
            </div>
            <div id="body_doc_form" class="modal-body" style="height:auto!important">

            </div>

            <div class="modal-footer">
                <button id="id_dgsign" onclick="btn_signDGSign()" type="button" class="btn btn-success pull-left"><i class="fa fa-pencil"></i> Sign via DGSign</button>
                <button id="id_forreview" onclick="btn_submitForReview()" type="button" class="btn btn-success pull-left"><i class="fa fa-view"></i> Submit for Review</button>

                <button id="btn_doc_configure" onclick="cofigure_logo()" type="button" class="btn btn-default"><i class="fa fa-gear"></i> Configure Logo</button>
                <button id="btn_proceed" onclick="cofigure_logo()" type="button" class="btn btn-default"><i class="fa fa-arrow-right"></i> Proceed</button>

                <button onclick="btn_save_dv()" type="button" class="btn btn-success"><i class="fa fa-save"></i> Save Changes</button>

                <button type="button" class="btn btn-default" onclick="removezindex()" style="cursor:pointer" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<div class="modal " id="mdl_doc_com" data-backdrop="static" data-keyboard="false" role="dialog" aria-hidden="true" style="display: none;">
    <div class="modal-dialog modal-dialog-full">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true" onclick="removezindex()">x</button>
                <h4 id="h_doc_com_id" class="modal-title">Transaction Information</h4>
            </div>
            <div id="body_com_form" class="modal-body" style="height:auto!important">

            </div>
            <div class="modal-footer">
                <button onclick="btn_save_dv()" type="button" class="btn btn-success"><i class="fa fa-save"></i> Save Changes</button>

                <button type="button" class="btn btn-default" onclick="removezindex()" style="cursor:pointer" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<div class="modal " id="mdl_rpt" data-backdrop="static" data-keyboard="false" role="dialog" aria-hidden="true" style="display: none;">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true" onclick="removezindex()">x</button>
                <h4 id="h_rpt" class="modal-title">Print Priview</h4>
            </div>
            <div id="body_rpt_id" class="modal-body" style="height:auto!important">

            </div>
            <div class="modal-footer">
                <button onclick="print_div()" type="button" class="btn btn-success"><i class="fa fa-print"></i> Print</button>
                <button type="button" class="btn btn-default" onclick="removezindex()" style="cursor:pointer" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<div class="modal" id="mdl_trackhistory" data-backdrop="static" data-keyboard="false" role="dialog" aria-hidden="true" style="display: none;">
    <div class="modal-dialog modal-lg " style="min-width:1200px">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>
                <h4 id="h_trackhistory_id" class="modal-title">Document History</h4>
            </div>
            <div id="body_trackhistory" class="modal-body" style="height:auto!important">

            </div>
            <div class="modal-footer">

            </div>
        </div>
    </div>
</div>


<script>
    function removezindex() {
        $("#mdl_newstatus").removeClass("zdex");
    }
    //$('#mdl_doc_form').on('show.bs.modal', function () {
    //    $(this).find('.modal-dialog').css({
    //        width: 'auto',
    //        height: 'auto',
    //        'max-height': '100%'
    //    });
    //});
</script>


@*asdfasdf
    asdf
    asdf
    as
    dfsdf*@