
@{
    ViewBag.Title = "_account_sub";
    Layout = null;
    @model WebAOMS.Models.tbl_t_DocEvents
}
<style>
    html, body {
        padding: 0;
        margin: 0;
        height: 100%;
        min-height: 100%;
    }

    body {
        box-sizing: border-box;
        font-size: 10pt;
        font-family: Arial;
        margin-top: -1px;
        padding: 5px .4em 0;
        word-wrap: break-word;
        -webkit-nbsp-mode: space;
        -webkit-line-break: after-white-space;
    }

    h1 {
        font-size: 2em;
        margin: .67em 0;
    }

    h2 {
        font-size: 1.5em;
    }

    h3 {
        font-size: 1.16em;
    }

    h4 {
        font-size: 1em;
    }

    h5 {
        font-size: .83em;
    }

    h6 {
        font-size: .7em;
    }

    p {
        margin: 0 0 1em;
    }

    .k-marker {
        display: none;
    }

    .k-paste-container, .Apple-style-span {
        position: absolute;
        left: -10000px;
        width: 1px;
        height: 1px;
        overflow: hidden;
    }

    ul, ol {
        padding-left: 2.5em;
    }

    span {
        -ms-high-contrast-adjust: none;
    }

    a {
        color: #00a;
    }

    code {
        font-size: 1.23em;
    }

    telerik\3Ascript {
        display: none;
    }

    .k-table {
        width: 100%;
        border-spacing: 0;
        margin: 0 0 1em;
    }

        .k-table td {
            min-width: 1px;
            padding: .2em .3em;
        }

        .k-table, .k-table td {
            outline: 0;
            border: 1px dotted #ccc;
        }

            .k-table p {
                margin: 0;
                padding: 0;
            }

    .k-column-resize-handle-wrapper {
        position: absolute;
        height: 10px;
        width: 10px;
        cursor: col-resize;
        z-index: 2;
    }

    .k-column-resize-handle {
        width: 100%;
        height: 100%;
    }

        .k-column-resize-handle > .k-column-resize-marker {
            width: 2px;
            height: 100%;
            margin: 0 auto;
            background-color: #00b0ff;
            display: none;
            opacity: 0.8;
        }

    .k-row-resize-handle-wrapper {
        position: absolute;
        cursor: row-resize;
        z-index: 2;
        width: 10px;
        height: 10px;
    }

    .k-row-resize-handle {
        display: table;
        width: 100%;
        height: 100%;
    }

    .k-row-resize-marker-wrapper {
        display: table-cell;
        height: 100%;
        width: 100%;
        margin: 0;
        padding: 0;
        vertical-align: middle;
    }

    .k-row-resize-marker {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 2px;
        background-color: #00b0ff;
        opacity: 0.8;
        display: none;
    }

    .k-table-resize-handle-wrapper {
        position: absolute;
        background-color: #fff;
        border: 1px solid #000;
        z-index: 100;
        width: 5px;
        height: 5px;
    }

    .k-table-resize-handle {
        width: 100%;
        height: 100%;
    }

        .k-table-resize-handle.k-resize-east {
            cursor: e-resize;
        }

        .k-table-resize-handle.k-resize-north {
            cursor: n-resize;
        }

        .k-table-resize-handle.k-resize-northeast {
            cursor: ne-resize;
        }

        .k-table-resize-handle.k-resize-northwest {
            cursor: nw-resize;
        }

        .k-table-resize-handle.k-resize-south {
            cursor: s-resize;
        }

        .k-table-resize-handle.k-resize-southeast {
            cursor: se-resize;
        }

        .k-table-resize-handle.k-resize-southwest {
            cursor: sw-resize;
        }

        .k-table-resize-handle.k-resize-west {
            cursor: w-resize;
        }

    .k-table.k-table-resizing {
        opacity: 0.6;
    }

    k\:script {
        display: none;
    }
     #navbar {
      /*background-color: #333;*/
      position: fixed;
      top: 40px;
      right:-50px;
      width: 40px;
      display: block;
        font-size: 8pt;
        font-family: Verdana;
        height: 40px;
        /*border: 1px solid #4f4f4f;*/
        z-index:500
}

     .k-grid .k-edit-cell .description-textarea {
    width: 100%;
    height: 100%;
    resize: none; /* Optional: To prevent users from resizing the textarea */
}
</style>


<div id="navbar">
    <button onclick="print_preview(@ViewBag.doc_details_id, @ViewBag.report_id)" type="button" class="btn btn-success"><i class="fa fa-print"></i> Preview</button>
</div>

<div id="div_details" class="box" style="width:100%;margin-bottom:0px!important">
    <div id="div_" class="box-body">
        @Html.Raw(ViewBag.script)
       
        <form id="frm_doc_details_value" style="min-width:15.9258cm">
            <input name="report_id" value="@ViewBag.report_id" type="text" hidden/>
            <input id="txt_doc_details_id" name="doc_details_id" value="@ViewBag.doc_details_id" type="text" hidden />
            <input name="doc_form_id" value="@ViewBag.doc_form_id" type="text" hidden />

            <input  id="txt_refno_sub" name="refno" value="@ViewBag.refno" type="text" hidden  />
            <input id="txt_officeid_sub" name="officeid" type="text" hidden />
            <input id="txt_particular_sub" name="particular" type="text" hidden />
            <div class="row">
                <script>

                    function para_wfp(){
                        return {year:2025,officeid:$("#officeChargewfp").data("kendoDropDownList").value(),isPLC:true}
                    }

                    function r_wfp(){
                        var r_l = $("#wpfAccount").data("kendoDropDownList")
                        r_l.dataSource.read();

                        $("#wpfAccount").data("kendoDropDownList").value('@ViewBag.SpecificActivity_id')
                    }

                    function loaded(){
                        stopSpin()

                    }

                </script>

                <div class="form-group">
                    <label for="title">Office Charge:</label>
                    @(Html.Kendo().DropDownList()
                    .Name("officeChargewfp")
                    .DataTextField("OfficeName")
                    .DataValueField("OfficeID")
                    .Filter("Contains")
                    .AutoBind(false)
                    .DataSource(source =>
                    {
                        source.Read(read =>
                        {
                            read.Action("DataSource_GetOffice_fmis_pmis", "Document");
                        });
                    })
                    .Events(e => e.Change("r_wfp"))
                    .HtmlAttributes(new { style = "width: 100%" })
                    .Popup(p => p.AppendTo("#mdl_doc_form"))
                                    )
                </div>
                <script>
                    function selectWFPAccount(e) {
                        var dataItem = this.dataItem(e.item.index());
                        insertDocEvent(dataItem.SpecificActivity_id)
                    }

                    function insertDocEvent(specificActivityid){

                        startSpin()
                        var txt_doc_details_id = $("#txt_doc_details_id").val()

                        $.post('@Url.Action("AutoInsert_DocEventsAndBR_2025", "Document")',
                            { doc_details_id: txt_doc_details_id,specificActivityID:specificActivityid,officeid:$("#officeChargewfp").data("kendoDropDownList").value()}
                        , function(r) {
                            if (r.code == 6)
                            {
                                stopSpin()
                                toastr.success(r.statusName, 'System Message')
                                var grid = $("#Grid_BudgetaryRequirements").data("kendoGrid");
                                grid.dataSource.read();
                            }
                            else
                            {
                                stopSpin()
                                toastr.warning(r.statusName, 'System Message');
                            }
                        })
                    }

                </script>
                <div class="form-group">
                    @Html.Hidden("SpecificActivity", null, new { @id = "txt_SpecificActivity_id" })

                    <label for="title">Specific Activity:</label>
                    @(Html.Kendo().DropDownList()
                    .Name("wpfAccount")
                    .DataTextField("SpecificActivity")
                    .DataValueField("SpecificActivity_id")
                    .Filter("Contains")
                    .AutoBind(false)
                    .DataSource(source =>
                    {
                        source.Read(read =>
                        {
                            read.Action("datasource_activitySchedule_2025", "Document").Data("para_wfp");
                        });
                    })
                    .Events(e => e.DataBound("loaded").Select("selectWFPAccount"))
                    .HtmlAttributes(new { style = "width: 100%" })
                    .Popup(p => p.AppendTo("#mdl_doc_form"))
                )
                </div>
                <script>
                    //$("body").on("change", "#wpfAccount", function () {

                    //    // Get a reference to the Kendo DropDownList
                    //    var dropdownlist = $("#wpfAccount").data("kendoDropDownList");

                    //    // Get the text value of the currently selected item
                    //    var selectedText = dropdownlist.text();
                    //    $("#txt_SpecificActivity_id").val(selectedText);
                    //    $("#txt_title").val(selectedText);
                        
                    //});
                </script>
            </div>

            <div id="div_doc_content" class="row">
                

                <div class="form-group">
                    <label for="estimated-amount">Title</label>
                    <input id="txt_title" type="text" name="Title" style="font-family:Candara;font-size:12pt" value="@ViewBag.Activitytitle" class="form-control" />
                </div>
                <div class="form-group">
                    <label for="estimated-amount">Inclusive Date</label><div style="font-family:Arial;font-style:italic;color:darkgreen;padding-bottom:10px">The inclusive date must be at least 14 days in advance for acceptance.</div>
                    <div class="input-group">
                        <script>
                            function mutli_para(){

                                return { doc_details_id: @ViewBag.doc_details_id }
                            }
                            function deselectdate(e) {
                                var dataItem = e.dataItem;
                                removeFromDatabase(dataItem.doc_details_id_incl);
                            }

                        </script>
                        <input id="txt_inclusive_date" type="text" name="InclusiveDate" style="font-family:Candara;font-size:12pt" readonly value="@ViewBag.InclusiveDate" class="form-control" />
                        <span class="input-group-btn dropup" style="padding-left:4px">
                            <button id="openModal" class="btn btn-equal"  type="button"><i class="fa fa-calendar"></i></button>
                        </span>
                    </div>
                </div>
                <div class="form-group">
                    <label for="">Venue</label>
                    <div class="input-group">
                        @{
                            int report_id = ViewBag.report_id;

                            <script>

                            </script>
                            if (report_id == 57 || report_id == 58)
                            {

                                Html.Kendo().DropDownList()
                                .Name("Venue")
                                .DataTextField("venue")
                                .DataValueField("venue")
                                .Filter("Contains")
                                .AutoBind(false)
                                .DataSource(source =>
                                {
                                    source.Read(read =>
                                    {
                                        read.Action("DataSource_GetVenue", "Document").Data("para_wfp");
                                    });
                                })
                                .HtmlAttributes(new { style = "width: 100%" })
                                .Popup(p => p.AppendTo("#mdl_doc_form"))
                                .Render();



                            }
                            else if (report_id == 48 || report_id == 49)
                            {
                                <input id="txt_venue" type="text" style="font-family:Candara;font-size:12pt" name="Venue" value="@ViewBag.Venue" class="form-control" />
                            }
                        }
                        <span class="input-group-btn dropup" style="padding-left:4px">
                            <button id="openAdd" class="btn btn-equal" type="button"><i class="fa fa-plus"></i></button>
                        </span>
                        </div>

                    </div>
                @*<label for="title">Content</label>
                @Html.Raw(ViewBag.html)*@

                @*inclusive date*@
                <script>
                    function removeFromDatabase(docdetailsidincl) {
                        $.ajax({
                            url: '@Url.Action("RemoveInclusiveDate", "Document")', // Replace with your actual controller and action method for database removal
                            type: 'POST',
                            data: { doc_details_id_incl: docdetailsidincl },
                            success: function() {
                                toastr.success("Successfully removed", 'System Message')
                                r_grid_inclusive()
                            },
                            error: function() {
                                toastr.warning("Error removing item from database.", 'System Message')

                            }
                        });
                    }

                    

                    $(document).ready(function() {
                        $("#insertBtn").click(function(event) {

                            var selectedDate = $("#datepicker").data("kendoDatePicker").value();
                            if (selectedDate) {
                                if (selectedDate.getFullYear() !== 2025) {
                                    toastr.warning("Only dates in 2025 are allowed.", 'System Message');
                                } else {
                                    insertData(selectedDate); // Proceed with your data insertion logic
                                }
                            } else {
                                toastr.warning("Please select a date.", 'System Message');
                            }
                        });

                        $("#openModal").click(function() {
                            r_grid_inclusive()
                            $("#myModal").modal("show");
                        });


                        $("#openAdd").click(function() {
                            $("#openAddVenue").modal("show");
                        });
                        $("#closeDate").click(function() {
                            $("#myModal").modal("hide");
                        });
                        $("#closeAddVenue").click(function() {
                            $("#openAddVenue").modal("hide");
                        });

                        function insertData(date) {
                            var grid = $("#grid_inclusivedate").data("kendoGrid");
                            var newDate = kendo.toString(date, "MM/dd/yyyy")

                            // Get the data items from the Grid
                            var gridData = grid.dataSource.data();

                            // Check if the new date already exists in the Grid
                            var dateExists = false;
                            for (var i = 0; i < gridData.length; i++) {
                                if (newDate === gridData[i].InclusiveDate) {
                                    dateExists = true;
                                    break;
                                }
                            }

                            // Show a validation message if the date already exists
                            if (dateExists) {
                                toastr.warning("The selected date already exists in the grid.", 'System Message')
                            } 
                            else {
                                // Perform any other actions if the date is valid
                                // For example, you can add the new date to the Grid
                                $.post('@Url.Action("InsertInclusiveDate", "Document")',
                                   { InclusiveDate: kendo.toString(date, "MM/dd/yyyy"),
                                       doc_details_id: @ViewBag.doc_details_id// Format the date as needed}
                                   }
                               , function (r) {
                                   if (r.success)
                                   {
                                       toastr.success("Data inserted successfully.", 'System Message')
                                       r_grid_inclusive()
                                   }

                               })
                               .fail(function (jqXHR, textStatus, error) {
                                   stopSpin()
                                   mg.warning("" + textStatus + "")
                               });
                            }
                        }

                    });
                    function get_inclusiveFromGrid(){
                        var grid = $("#grid_inclusivedate").data("kendoGrid");
                            
                        var str='';
                        // Get the data items from the Grid
                        var gridData = grid.dataSource.data();

                        // Check if the new date already exists in the Grid
                        var dateExists = false;
                        for (var i = 0; i < gridData.length; i++) {
                            if(i==0)
                            {
                                str=str+ gridData[i].InclusiveDate
                            }
                            else{

                                str=str+ ', '+gridData[i].InclusiveDate
                            }
                        }
                        $("#txt_inclusive_date").val(str)
                    }
                </script>
                <script>
                    function resizeEditor(e) {
                        var editor = e.sender;
                        var editorContent = editor.value();
                        var editorHeight = editor.wrapper.height();
                        var newEditorHeight = editorContent ? editorContent.split(/\r\n|\r|\n/).length * 24 : 100;

                        if (newEditorHeight > editorHeight) {
                            editor.wrapper.height(newEditorHeight);
                        }
                    }
                </script>

                <div class="form-group">
                    @Html.LabelFor(model => model.Rationale)
                    <textarea style="font-size:12pt;font-family:Candara;" rows="10" name="Rationale" class="form-control">@ViewBag.Rationale</textarea>
                </div>

                <div class="form-group">
                    @Html.LabelFor(model => model.Objectives)
                    <textarea style="font-size:12pt;font-family:Candara;" rows="10" name="Objectives" class="form-control">@ViewBag.Objectives</textarea>
                </div>
                @if (@ViewBag.report_id == 49 || @ViewBag.report_id == 58)
                {
                <div class="form-group">
                    @Html.LabelFor(model => model.Methodology)
                    <textarea style="font-size:12pt;font-family:Candara;" rows="10" name="Methodology" class="form-control">@ViewBag.Methodology</textarea>
                </div>
                }
                <div class="form-group">
                    @Html.LabelFor(model => model.ExpectedOutput)
                    <textarea style="font-size:12pt;font-family:Candara;" rows="10" name="ExpectedOutput" class="form-control">@ViewBag.ExpectedOutput</textarea>
                </div>

                <script type="text/javascript">
                    function error_handler(e) {
                        if (e.errors) {
                            var message = "Errors:\n";
                            $.each(e.errors, function (key, value) {
                                if ('errors' in value) {
                                    $.each(value.errors, function() {
                                        message += this + "\n";
                                    });
                                }
                            });
                            alert(message);
                        }
                    }

                    function gridtppara(){
                        return {eventId:@ViewBag.doc_details_id}
                    }

                    function getDocdetailsID(){
                        return{ doc_details_id:@ViewBag.doc_details_id}
                    }
                    function sync_handler(e) {
                        this.read();
                    }
                </script>

                <div class="form-group">
                    <label for="estimated-amount">Target Participants</label>
                    
                    @(Html.Kendo().Grid<WebAOMS.Models.TargetParticipant>()
                        .Name("Grid_TargetParticipants")
                        .Columns(columns =>
                        {
                            columns.Bound(p => p.Participant);//.ClientTemplate("#=renderParticipant(data)#");
                            columns.Bound(p => p.NoOfPax).Width(90).HtmlAttributes(new { style = "text-align:center" }); ;
                            columns.ForeignKey(p => p.OfficeID, ViewBag.offices as IEnumerable<WebAOMS.Models.tbl_l_PMISOffice>, "OfficeID", "OfficeAbbr").Filterable(ftb => ftb.Multi(true)).Title("Office to be notify").Width(140);
                            columns.Command(command => { command.Edit(); command.Destroy(); }).Width(200);
                        })
                        .ToolBar(toolbar => toolbar.Create())
                        .Editable(editable => editable.Mode(GridEditMode.InLine).CreateAt(GridInsertRowPosition.Bottom).ConfirmDelete("Continue to delete this record?").DisplayDeleteConfirmation("Continue to delete this record?")).Pageable()
                        .Sortable()
                        .Scrollable()
                        .HtmlAttributes(new { style = "height:300px;" })
                        .DataSource(dataSource => dataSource
                            .Ajax()
                            .PageSize(20)
                            .Events(events => events.Error("error_handler"))
                            .Model(model => model.Id(p => p.ParticipantId))
                            .Create(update => update.Action("TPEditingInline_Create", "Document").Data("getDocdetailsID"))
                            .Read(read => read.Action("TPEditingInline_Read", "Document").Data("gridtppara"))
                            .Update(update => update.Action("TPEditingInline_Create", "Document").Data("getDocdetailsID"))
                            .Destroy(update => update.Action("TPEditingInline_Destroy", "Document"))
                        )
                    )

                </div>
                <script>
                    function refresh_approved(){
                        var r_l = $("#SigApproved").data("kendoComboBox")
                        r_l.dataSource.read();
                    }
                </script>
                <div class="form-group">
                    <label for="estimated-amount">Budgetary Requirements</label>
                   @(Html.Kendo().Grid<WebAOMS.Models.tbl_t_DocEvents_BudgetaryRequirements>()
                        .Name("Grid_BudgetaryRequirements")
                        .Columns(columns =>
                        {
                            columns.Bound(p => p.Particular)
              .Width(250)
              .EditorTemplateName("ParticularTextArea");
                            columns.Bound(p => p.item_names).Title("Item name").Width(120);
                            columns.Bound(p => p.item_price).Title("Price").Width(80).Format("{0:N2}").HtmlAttributes(new { style = "text-align:right" });
                            columns.Bound(p => p.item_qty).Title("Quantity").Width(70).Format("{0:N0}").HtmlAttributes(new { style = "text-align:center" });
                            columns.Bound(p => p.OriginalQty).Title("Remaining Qty").Width(70).Format("{0:N0}").HtmlAttributes(new { style = "text-align:center" });

                            columns.Bound(p => p.Amount).Title("Total Amount").Width(80).Format("{0:N2}").HtmlAttributes(new { style = "text-align:right" });
                            columns.Command(command => { command.Edit(); }).Width(80);
                        })
                        .ToolBar(toolbar => toolbar.Create())
                        .Editable(editable => editable.Mode(GridEditMode.InLine).CreateAt(GridInsertRowPosition.Bottom).ConfirmDelete("Continue to delete this record?").DisplayDeleteConfirmation("Continue to delete this record?"))
                        .Pageable()
                        .Sortable()
                        .Scrollable()
                        .HtmlAttributes(new { style = "height:300px;" })
                        .DataSource(dataSource => dataSource
                        .Ajax()
                        .PageSize(200)

                        .Events(events => events.Error("error_handler").Sync("sync_handler"))

                        .Model(model =>
                        {
                            model.Id(gridMainAlias => gridMainAlias.BudgetId);
                            model.Field(gridMainAlias => gridMainAlias.Particular).Editable(true);
                            model.Field(gridMainAlias => gridMainAlias.item_qty).Editable(true);
                            model.Field(gridMainAlias => gridMainAlias.item_names).Editable(false);
                            model.Field(gridMainAlias => gridMainAlias.item_price).Editable(true);
                            model.Field(gridMainAlias => gridMainAlias.OriginalQty).Editable(false);
                            model.Field(gridMainAlias => gridMainAlias.Amount).Editable(false);
                        })
                        .Create(update => update.Action("BREditingInline_Create", "Document").Data("getDocdetailsID"))
                        .Read(read => read.Action("BREditingInline_Read", "Document").Data("gridtppara"))
                        .Update(update => update.Action("BREditingInline_Create", "Document").Data("getDocdetailsID"))
                        .Destroy(update => update.Action("BREditingInline_Destroy", "Document"))
                    )
                    .Events(e => e.DataBound("refresh_approved")))
            </div>
               
                @if (@ViewBag.report_id == 49 || @ViewBag.report_id == 58 )
                {
                    <script>
                    function clickUpDown() {

                        var grid = $("#Grid_IPS").data("kendoGrid");
                        //grid.dataSource.read();

                        $(".btnUp").on("click", function(e) {

                           var selectedItem = $(this).closest("tr");
                           var selectedUid = selectedItem.attr("data-uid");
                           var itemIndex = selectedItem.index();
                           var dataItem = grid.dataItem(selectedItem);

                           var newIndex = itemIndex - 1;
                           var content = $(".k-grid-content");
                           var offset = selectedItem.offset().top;

                           if (newIndex <= 0) {
                               newIndex = 0;
                           }

                           //grid.dataSource.remove(dataItem);
                           //grid.dataSource.insert(newIndex, dataItem);

                           grid.select("[data-uid=" + selectedUid +"]");

                           //content.scrollTop(offset);
                       });

                       $(".btnDown").on("click", function(e) {
                           var selectedItem = $(this).closest("tr");
                           var selectedUid = selectedItem.attr("data-uid");
                           var itemIndex = selectedItem.index();
                           var dataItem = grid.dataItem(selectedItem);

                           var newIndex = itemIndex + 1;
                           var content = $(".k-grid-content");

                           var offset = selectedItem.offset().top;

                           if (newIndex < grid.dataSource.view().length) {
                               //grid.dataSource.remove(dataItem);
                               //grid.dataSource.insert(newIndex, dataItem);

                               grid.select("[data-uid=" + selectedUid +"]");

                               //content.scrollTop(offset);
                           }
                       });
                    }
                    function addRowIndex() {
                        var grid = $("#Grid_IPS").data("kendoGrid");
                        var dataItem = this.dataItem;

                        // Get the index of the current data item
                        var index = grid.dataSource.indexOf(dataItem) + 1;

                        return index;
                    }
                    function sync_handler(e) {
                        this.read();
                    }
                    </script>

                    <div class="form-group">
                        <label for="estimated-amount">Indicative Programming of Schedule:</label>
                        @(Html.Kendo().Grid<WebAOMS.Models.DocEvents_IPS>()
                        .Name("Grid_IPS")
                        .Columns(columns =>
                        {
                            columns.Bound(p => p.DTE).Title("Schedule").Width(100);
                            columns.Bound(p => p.Activity).Title("Activity").Width(290).EditorTemplateName("ActivityColumn").ClientTemplate("<pre name='Activity'  style='border:none;margin:1px;font-family:arial;font-size:10pt'>#=Activity#</pre>").HtmlAttributes(new { style = "padding:0;top:0;" });
                            columns.Bound(p => p.AssignPerson).Title("Responsible Person").Width(150);
                            columns.Bound(p => p.orderby).Title("Order").Width(60);
                            columns.Command(command => { command.Edit(); command.Destroy(); }).Width(150);
                        })
                        .ToolBar(toolbar => toolbar.Create())
                        .Editable(editable => editable.Mode(GridEditMode.InLine).CreateAt(GridInsertRowPosition.Bottom).ConfirmDelete("Continue to delete this record?").DisplayDeleteConfirmation("Continue to delete this record?"))

                        .Scrollable()
                        .Selectable(selectable => selectable
                        .Mode(GridSelectionMode.Single))
                        .HtmlAttributes(new { style = "height:800px;" })
                        .DataSource(dataSource => dataSource
                        .Ajax()
                        .Sort(sort => sort.Add("orderby").Ascending())
                        .Model(model => model.Id(p => p.IPS_Id))

                        .Create(update => update.Action("IPSEditingInline_Create", "Document").Data("getDocdetailsID"))
                        .Read(read => read.Action("IPSEditingInline_Read", "Document").Data("gridtppara"))
                        .Update(update => update.Action("IPSEditingInline_Create", "Document").Data("getDocdetailsID"))
                        .Destroy(update => update.Action("IPSEditingInline_Destroy", "Document"))
                        .Events(events => events.Error("error_handler").Sync("sync_handler"))
                    )
                    )
                    </div>
                }

                <div class="form-group">
                    <label for="title">Source of Fund:</label>
                    <input  type="text" style="font-family:Candara;font-size:12pt" name="SourceOfFund" value="@ViewBag.SourceOfFund" class="form-control"/>
                </div>
                <div class="form-group">
                    <label for="title">Caterer:</label>
                    <input  type="text" style="font-family:Candara;font-size:12pt" name="Caterer" value="@ViewBag.Caterer" class="form-control"/>
                </div>
                <div  class="row" style="padding-top:15px">
                    <div class="col-md-6">
                        <script>
                   
                        </script>
                        <input type="hidden" name="recommendApproval" id="recommendApprovalHidden" />
                        <label for="recommendApproval">Recommending Approval:</label>
                        @(Html.Kendo().MultiSelect()
                        .Name("MrecommendApproval")
                        .DataTextField("NameFML")
                        .DataValueField("eid")
                        .Filter("contains")
                        .Placeholder("Select employees...")
                        .AutoBind(true)
                        //.ItemTemplate("<span style='display:flex; justify-content:space-between; width:100%;'><span>#: NameFML #</span><span style='opacity:0.6;'>#: Position #</span></span>")
                        .DataSource(source =>
                        {
                            source.Read(read =>
                            {
                                read.Action("DataSource_employee_recommendingApprove", "Document");
                            });
                        })
                        .HtmlAttributes(new { style = "width: 100%" })
                                            )



                    </div>
                    <script>
                        function DGSignApproved_para(){
                            return {doc_details_id:"@ViewBag.doc_details_id",officeid:$("#officeId").data("kendoDropDownList").value()}
                        }
                    </script>
                    <div  class="col-md-6">
                        <label for="title">Approved by:</label>
                        @(Html.Kendo().ComboBox()
                        .Name("SigApproved")
                        .DataTextField("NameFML")
                        .DataValueField("eid")
                        .Filter("Contains")
                        .AutoBind(true)
                        .DataSource(source =>
                        {
                            source.Read(read =>
                            {
                                read.Action("DataSource_DGSignApproved", "Document").Data("DGSignApproved_para");

                            }).ServerFiltering(true);
                        })
                        .HtmlAttributes(new { style = "width: 100%" })
                               
                        )

                    </div>
                </div>
        </div>
        </form>
    </div>
</div>
<script>
    function Close_mdl_doc_form(){
        removezindex();
        $("#body_doc_form").html("");
        $("#mdl_doc_form").modal("hide");
    }

    function btn_signDGSign()
    {
        startSpin()
        var txt_doc_details_id = $("#txt_doc_details_id").val()
        $.post('@Url.Action("SignViaDG", "DGSign")',
            { doc_details_id: txt_doc_details_id,code:$("#txt_refno").val(),reportid: @ViewBag.report_id}
        , function(r) {
            if (r.code == 6)
            {
                stopSpin()
                toastr.success(r.statusName, 'System Message')
                Close_mdl_doc_form()
            }
            else
            {
                stopSpin()
                toastr.warning(r.statusName, 'System Message');
            }
        })
    }

    function btn_submitForReview()
    {
        var val = $("#SigApproved").data("kendoComboBox").value();
        if (val =="")
        {
            toastr.warning(r.statusName, 'Approve signatory is required');
        }
        else{
        startSpin()
            var txt_doc_details_id = $("#txt_doc_details_id").val()
            $.post('@Url.Action("ForReview", "DGSign")',
                { doc_details_id: txt_doc_details_id,refno:$("#txt_refno").val(),reportid: @ViewBag.report_id}
            , function(r) {
                if (r.code == 6)
                {
                    stopSpin()
                    toastr.success(r.statusName, 'System Message')
                    Close_mdl_doc_form()
                }
                else
                {
                    stopSpin()
                    toastr.warning(r.statusName, 'System Message');
                }
            })
        }
        
       
    }
                </script>
<script>

    var mg = new mgsInfo()

    function btn_save_dv()
    {
        startSpin()
        var orderedValues = $("#MrecommendApproval").getKendoMultiSelect().value(); // gets in user-selected order
        $("#recommendApprovalHidden").val(orderedValues.join(',')); // write to hidden input


        var frm = $("#frm_doc_details_value").serialize();
        $.post('@Url.Action("save_Doc_details", "Document")',
            frm
        , function(r) {
            if (r.code == 6)
            {
                toastr.success(r.statusName, 'System Message')
                $("#txt_doc_details_id").val(r.doc_details_id)
                stopSpin()
                r_grid_attach_doc()
                print_preview(@ViewBag.doc_details_id, @ViewBag.report_id)
            }
            else
            {
                stopSpin()
                toastr.warning(r.statusName, 'System Message');
            }
        })
        @*.fail(function (jqXHR, textStatus, error) {
            stopSpin()
            mg.warning("" + textStatus + "")
            print_preview(@ViewBag.doc_details_id, @ViewBag.report_id)
        });*@
    }


    $(document).ready(function () {
        startSpin()
        $("#txt_refno_sub").val($("#txt_refno").val())
        $("#txt_officeid_sub").val($("#officeId").data("kendoDropDownList").value())
        $("#txt_particular_sub").val($("#txt_particular").val())

        $("#officeChargewfp").data("kendoDropDownList").value(@ViewBag.officeCharge)
        //$("#recommendApproval").data("kendoMultiColumnComboBox").value('@ViewBag.recommendingApprove');
        $("#MrecommendApproval").getKendoMultiSelect().value('@ViewBag.recommendingApprove'.split(','))





        $("#SigApproved").data("kendoComboBox").value(@ViewBag.approveby)
        r_wfp()
        @*setTimeout(function(){
            $("#wpfAccount").data("kendoDropDownList").value('@ViewBag.SpecificActivity_id')

        },2000)*@

    })

    function cofigure_logo() {
        startSpin()
        $.post('@Url.Action("_configure_logo", "Document")', {doc_details_id: $("#txt_doc_details_id").val()}
        , function (r) {
            $("#body_configure_logo").html(r)
            $("#mdl_configure_logo").modal("show");
            stopSpin();
        })
    }


        </script>
<div class="modal" id="openAddVenue">
    <div class="modal-dialog ">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add Venue</h5>
            </div>
            <div class="modal-body">
                <div class="box-body">
                    <form id="frm_venue_details">
                        <div class="form-group">
                            <label for="venueName">Venue Name</label>
                            <input type="text" id="venueName" name="venueName" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="venueAddress">Address</label>
                            <input type="text" id="venueAddress" name="venueAddress" class="form-control" required>
                        </div>
                    </form>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" onclick="btn_save_venue()" class="btn btn-success">Save</button>
                <button id="closeAddVenue" type="button" class="btn btn-primary">Close</button>
            </div>
        </div>
    </div>
    <script>
    function btn_save_venue() {
        startSpin();
        var frm = $("#frm_venue_details").serialize();
        $.post('@Url.Action("save_Venue", "Document")', frm, function(r) {
            if (r.code == 6) {
                toastr.success(r.statusName, 'System Message');
                stopSpin();
                $("#frm_venue_details")[0].reset(); // Clear form fields
                $("#openAddVenue").modal("hide"); // Close modal
                // TODO: Refresh venue list or update UI accordingly
            } else {
                stopSpin();
                toastr.warning(r.statusName, 'System Message');
            }
        });
    }
    </script>
</div>


<div class="modal" id="myModal">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Inclusive Date</h5>

            </div>
            <div class="modal-body">
                <div class="box-body">
                    @(Html.Kendo().DatePicker()
                      .Name("datepicker")
                      .Value(System.DateTime.Now)
                      .WeekNumber(true)
                    )
                    <button id="insertBtn">Add Date</button>
                    @(Html.Kendo().Grid<dynamic>()
                    .Name("grid_inclusivedate")
                    .AutoBind(false)
                    .Scrollable()
                    .Columns(columns =>
                    {
                        columns.Bound("InclusiveDate").Title("Inclusive Date").Format("{0:MM/dd/yyyy}").Width(100);
                        columns.Template(@<text></text>)
                        .Width(60)
                        .HtmlAttributes(new { style = "text-align:left;font-size:10" })
                        .ClientTemplate("</button><button data-original-title=\"recompute\" type=\"button\" onclick=\"removeFromDatabase(#=doc_details_id_incl#)\" class=\"btn btn-xs btn-danger btn-equal\" style=\"margin-right:2px\"><i class=\"fa fa-trash\"></i></button>");
                    })
                    .HtmlAttributes(new { style = "height: 300px!important;" })
                    .DataSource(dataSource => dataSource
                    .Ajax()
                    
                    .Read(read => read.Action("get_grid_inclusive_date", "Document").Data("mutli_para"))

                    )
                    .Events(e => e.DataBound("get_inclusiveFromGrid"))
                    )
                </div>
                <script>
                    function r_grid_inclusive() {
                        var grid = $("#grid_inclusivedate").data("kendoGrid");
                        grid.dataSource.read();
                    }

                </script>
            </div>
            <div class="modal-footer">
                <button id="closeDate" type="button" class="btn btn-primary">Close</button>
            </div>
        </div>
    </div>
</div>
        <div class="modal" id="mdl_configure_logo" data-backdrop="static" data-keyboard="false" role="dialog" aria-hidden="true" style="display: none;z-index:9999;">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" aria-hidden="true" onclick="close_mdl_configure_logo()">x</button>
                        <h4 class="modal-title">Configure Document Logo</h4>
                    </div>
                    <div id="body_configure_logo" class="modal-body" style="height:auto!important">

                    </div>
                    <div class="modal-footer">
                        <button onclick="btn_save_custom_logo()" type="button" class="btn btn-success"><i class="fa fa-check"></i> Update Logo</button>
                        <button type="button" class="btn btn-default" onclick="close_mdl_configure_logo()" style="cursor:pointer">Close</button>
                    </div>
                </div>
            </div>
        </div>
    <div class="modal" id="m_change_picture" data-focus-on="input:first" data-backdrop="static" data-keyboard="false" role="dialog" aria-hidden="true" style="display: none;">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title" id="simpleModalLabel">Change Picture</h4>
                </div>
                <div class="modal-body" style="min-height:370px">
                </div>
                <div class="modal-footer" style="margin:0px">
                    <a class="btn file-btn">
                        <span>Upload</span>
                        <input type="file" id="upload" value="Choose a file" accept="image/*">
                    </a>
                    <button id="btn_save_2file" type="button" class="btn btn-success"><i class="fa fa-save"></i> Save Changes</button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                </div>
            </div>
        </div>
    </div>
