@using Microsoft.AspNet.Identity;
@using WebAOMS.Models;
@using Microsoft.AspNet.Identity.EntityFramework;

<div class="sidebar-content">
    <div class="nav-brand">
        <a class="main-brand" href="">
            <h3 class="text-light text-white"><span><strong>@ViewBag.rightSidebar_title</strong> </span></h3>
        </a>
    </div>
    <!-- BEGIN MENU SEARCH -->
    <form class="sidebar-search" role="search">
        <a href="#"><i class="fa fa-search fa-fw search-icon"></i><i class="fa fa-angle-left fa-fw close-icon"></i></a>
        <div class="form-group">
            <div class="input-group">
                <input type="text" class="form-control navbar-input" placeholder="Search...">
                <span class="input-group-btn">
                    <button class="btn btn-equal" type="button"><i class="fa fa-search"></i></button>
                </span>
                
            </div>
        </div>
    </form>
    <ul id="menuNav" class="main-menu">
    @{          
        if (Request.IsAuthenticated) { 
        fmisEntities fmisdb = new fmisEntities();
        var currentUserId = User.Identity.GetUserId();
        var manager = new UserManager<ApplicationUser>(new UserStore<ApplicationUser>(new ApplicationDbContext()));
        var currentUser = manager.FindById(currentUserId);
        var menu = fmisdb.w_UserMenu.Where(m => m.userid == currentUser.UserID && m.parent_id == 0).OrderBy(M => M.Ordering);

        foreach (var rw in menu)
        {
            int? parentid = rw.menu_id;
            string strmenu_id;
            strmenu_id = "a" + rw.menu_id.ToString();
            var menuitem = fmisdb.w_UserMenu.Where(M => M.parent_id == parentid && M.userid==currentUser.UserID).OrderBy(M => M.Ordering).ToList();
            <li>

                @if (rw.Actions=="none")
                            {
                    <a id="@strmenu_id"  href="#" title="@rw.MenuDescription"><i class="@rw.IconName"></i><span class="title">@rw.MenuName</span> <span class="expand-sign">+</span></a>
                }
                else
                {
                    <a id="@strmenu_id" href="@Url.Action(rw.Actions, rw.Controller)" title="@rw.MenuDescription"> <i class="@rw.IconName"></i><span class="title">@rw.MenuName</span></a>
                }
                @if (menuitem.Count> 0){
                    <ul>
                        @foreach (var item in menuitem)
                        {
                            strmenu_id = "a" + item.menu_id.ToString();

                            if (item.menu_id > 0)
                            {
                                <li><a id="@strmenu_id" href="@Url.Action(item.Actions, item.Controller)" title="@item.MenuDescription">@item.MenuName</a></li>
                            }
                        }
                    </ul>
                }
            </li>
            }
        }
    }
    </ul>
</div>


<script>
        $("#@ViewBag.menuid").addClass("active");
</script>
